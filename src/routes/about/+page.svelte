<script lang="ts">
	import	{ Timeline,	 type TimelineEvent } from '$lib';
	import { onMount } from 'svelte';
	
	const timelineEvents: TimelineEvent[] = [
		{
			id: '2025-shanghai-kongan-internship',
			title: 'ä¸Šæµ·æ§å®‰å®ä¹ ',
			date: '2025-07-15',
			description: 'å…¥èŒä¸Šæµ·æ§å®‰ï¼Œä½œä¸ºè½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆåŠ©ç†è¿›è¡Œç‹¬ç«‹Pythonè½¯ä»¶å¼€å‘å®ä¹ ã€‚',
			tags: ['Python', 'è½¯ä»¶å¼€å‘', 'å®ä¹ ', 'ä¸Šæµ·æ§å®‰'],
			type: 'work' as const,
			color: '#10B981'
		},
		{
			id: '2025-komeijihelper-project',
			title: 'å…¨æ ˆé¡¹ç›®å¼€å‘',
			date: '2025-03-01',
			description: 'å¤§ä¸‰ä¸‹å­¦æœŸè¯¾ç¨‹é¡¹ç›®ï¼Œä½¿ç”¨ Vue.js å’Œ Java SpringBoot è¿›è¡Œå…¨æ ˆå¼€å‘ komeijihelperï¼Œå¯¹å‰ç«¯å¼€å‘å…´è¶£å¤§å¢ã€‚',
			tags: ['Vue.js', 'SpringBoot', 'Java', 'å…¨æ ˆå¼€å‘'],
			type: 'project' as const,
			color: '#8B5CF6',
			link: 'https://github.com/komeijihelper/komeijihelper'
		},
		{
			id: '2025-android-kotlin-development',
			title: 'å®‰å“å¼€å‘å­¦ä¹ ',
			date: '2025-01-29',
			description: 'å¼€å§‹æ¥è§¦ Kotlin å®‰å“å¼€å‘ï¼Œä¸º PaperPig/MaimaiData é¡¹ç›®ä½œå‡ºè´¡çŒ®ã€‚',
			tags: ['Kotlin', 'Android', 'å¼€æºè´¡çŒ®'],
			icon: 'ï¿½',
			type: 'project' as const,
			color: '#3DDC84',
			link: 'https://github.com/PaperPig/MaimaiData'
		},
		{
			id: '2024-high-intensity-plugin-dev',
			title: 'Dalamud æ’ä»¶å¼€å‘',
			date: '2024-09-23',
			description: 'å¼€å§‹æ¥è§¦ C# ç±»åº“å¼€å‘ï¼Œé«˜å¼ºåº¦ä¸º Dalamud-DailyRoutines ç»„ç»‡æä¾›ä»£ç ï¼ŒæŒç»­åˆ° 2024å¹´12æœˆ28æ—¥ã€‚',
			tags: ['C#', 'æ’ä»¶å¼€å‘', 'Dalamud', 'æ¸¸æˆå·¥å…·'],
			type: 'project' as const,
			color: '#512BD4'
		},
		{
			id: '2024-flutter-meeting-room-system',
			title: 'Flutter å‰ç«¯å¼€å‘',
			date: '2024-09-27',
			description: 'å› è¯¾ç¨‹éœ€è¦ä½¿ç”¨ Flutter å¼€å‘ä¼šè®®å®¤ç®¡ç†ç³»ç»Ÿå‰ç«¯ï¼Œé¦–æ¬¡æ¥è§¦å‰ç«¯å¼€å‘é¢†åŸŸã€‚',
			tags: ['Flutter', 'Dart', 'å‰ç«¯å¼€å‘', 'è¯¾ç¨‹é¡¹ç›®'],
			icon: 'ï¿½',
			type: 'project' as const,
			color: '#0175C2',
			link: 'https://github.com/KirisameVanilla/meeting_room_appointment_system'
		},
		{
			id: '2024-csharp-snowbreak-tools',
			title: 'C# å¼€å‘èµ·ç‚¹',
			date: '2024-07-23',
			description: 'å› å°˜ç™½ç¦åŒºæ¸¸æˆå¼€å§‹æ¥è§¦ C#ï¼Œè¾…åŠ©å¼€å‘å°˜ç™½ç¦åŒºå·¥å…·ç®±é¡¹ç›®ã€‚',
			tags: ['C#', 'æ¸¸æˆå·¥å…·', 'å¼€æºé¡¹ç›®'],
			type: 'project' as const,
			color: '#512BD4',
			link: 'https://github.com/Makstein/SnowbreakGachaExport'
		},
		{
			id: '2024-bank-security-internship',
			title: 'é“¶è¡Œå®‰å…¨è¯„ä¼°å®ä¹ ',
			date: '2024-07-15',
			description: 'åœ¨å››å·æ–°ç½‘é“¶è¡Œå®‰å…¨è¯„ä¼°å²—è¿›è¡Œä¸ºæœŸä¸€ä¸ªæœˆçš„å­¦ä¹ ï¼ŒæŒæ¡äº†å¸¸è§æ¼æ´æ’æŸ¥å¤„ç†å’Œ DevSecOps ç†å¿µã€‚',
			tags: ['ç½‘ç»œå®‰å…¨', 'æ¼æ´è¯„ä¼°', 'DevSecOps', 'å®ä¹ '],
			type: 'work' as const,
			color: '#DC2626'
		},
		{
			id: '2023-python-java-courses',
			title: 'Python & Java å­¦ä¹ ',
			date: '2023-03-01',
			description: 'å¤§ä¸€ä¸‹å­¦æœŸå­¦ä¹  Python å’Œ Java çš„å­¦æ ¡è¯¾ç¨‹ï¼Œæ‰©å±•ç¼–ç¨‹è¯­è¨€æŠ€èƒ½ã€‚',
			tags: ['Python', 'Java', 'å­¦æ ¡è¯¾ç¨‹', 'é¢å‘å¯¹è±¡'],
			type: 'education' as const,
			color: '#F59E0B'
		},
		{
			id: '2022-university-enrollment',
			title: 'åå¸ˆå¤§è½¯å·¥å…¥å­¦',
			date: '2022-09-01',
			description: 'å…¥å­¦åä¸œå¸ˆèŒƒå¤§å­¦è½¯ä»¶å·¥ç¨‹ä¸“ä¸šï¼Œå¼€å§‹ç³»ç»Ÿå­¦ä¹  C è¯­è¨€ç¼–ç¨‹ã€‚',
			tags: ['åä¸œå¸ˆå¤§', 'è½¯ä»¶å·¥ç¨‹', 'Cè¯­è¨€', 'å¤§å­¦'],
			type: 'education' as const,
			color: '#3B82F6'
		},
		{
			id: '2022-cpp-introduction',
			title: 'ç¼–ç¨‹å¯è’™',
			date: '2022-07-01',
			description: 'é€šè¿‡è§‚çœ‹ C++ è§†é¢‘æ•™ç¨‹æ¥è§¦ç¼–ç¨‹åŸºç¡€çŸ¥è¯†ï¼Œè¸ä¸Šç¼–ç¨‹å­¦ä¹ ä¹‹è·¯ã€‚',
			tags: ['C++', 'ç¼–ç¨‹å…¥é—¨', 'è‡ªå­¦'],
			icon: 'ï¿½',
			type: 'education' as const,
			color: '#00599C'
		}
	];

	// ç”Ÿæˆå¤§çº²æ•°æ®ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
	const outlineItems = timelineEvents
		.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
		.map(event => ({
			id: event.id,
			title: event.title,
			year: new Date(event.date).getFullYear()
		}));

	// æŒ‰å¹´ä»½åˆ†ç»„å¤§çº²ï¼ˆæŒ‰å¹´ä»½æ’åºï¼‰
	const outlineByYear = outlineItems.reduce((acc, item) => {
		const year = item.year.toString();
		if (!acc[year]) acc[year] = [];
		acc[year].push(item);
		return acc;
	}, {} as Record<string, typeof outlineItems>);

	// æ’åºåçš„å¹´ä»½åˆ—è¡¨
	const sortedOutlineYears = Object.keys(outlineByYear).sort((a, b) => parseInt(a) - parseInt(b));

	let activeEventId = $state('');
	let showOutline = $state(true);
	let showMobileOutline = $state(false);

	// æ»šåŠ¨åˆ°æŒ‡å®šäº‹ä»¶
	function scrollToEvent(eventId: string) {
		const element = document.querySelector(`[data-id="${eventId}"]`);
		if (element) {
			element.scrollIntoView({ behavior: 'smooth', block: 'center' });
			activeEventId = eventId;
		}
	}

	// ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ›´æ–°æ¿€æ´»çŠ¶æ€
	onMount(() => {
		const handleScroll = () => {
			const timelineItems = document.querySelectorAll('[data-id]');
			const scrollTop = window.scrollY + window.innerHeight / 2;
			
			let currentActive = '';
			timelineItems.forEach((item) => {
				const rect = item.getBoundingClientRect();
				const top = rect.top + window.scrollY;
				const bottom = top + rect.height;
				
				if (scrollTop >= top && scrollTop <= bottom) {
					currentActive = item.getAttribute('data-id') || '';
				}
			});
			
			if (currentActive) {
				activeEventId = currentActive;
			}
		};

		window.addEventListener('scroll', handleScroll);
		handleScroll(); // åˆå§‹è°ƒç”¨
		
		return () => {
			window.removeEventListener('scroll', handleScroll);
		};
	});
</script>

<svelte:head>
	<title>å…³äºæˆ‘ - KirisameVanilla</title>
	<meta name="description" content="äº†è§£æˆ‘çš„ç¼–ç¨‹å­¦ä¹ å’Œå¼€å‘ç»å†" />
</svelte:head>

<div class="bg-gradient-to-br from-slate-50 to-blue-100 min-h-screen">
	<!-- ç§»åŠ¨ç«¯å¤§çº²æŒ‰é’® -->
	<button 
		class="lg:hidden top-20 right-4 z-50 fixed bg-white/90 hover:bg-white shadow-lg hover:shadow-xl backdrop-blur-sm p-3 border border-gray-200/50 rounded-full transition-all"
		onclick={() => showMobileOutline = !showMobileOutline}
		aria-label="æ‰“å¼€æ—¶é—´çº¿å¤§çº²"
	>
		<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
		</svg>
	</button>

	<!-- ç§»åŠ¨ç«¯å¤§çº²é®ç½© -->
	{#if showMobileOutline}
		<div 
			class="lg:hidden z-40 fixed inset-0 bg-black/50 transition-opacity"
			onclick={() => showMobileOutline = false}
			onkeydown={(e) => e.key === 'Escape' && (showMobileOutline = false)}
			role="button"
			tabindex="0"
			aria-label="å…³é—­å¤§çº²"
		></div>
	{/if}

	<!-- ç§»åŠ¨ç«¯å¤§çº² -->
	<div class="fixed top-0 right-0 h-full w-80 bg-white/95 backdrop-blur-sm shadow-xl border-l border-gray-200/50 z-50 transform transition-transform duration-300 lg:hidden {showMobileOutline ? 'translate-x-0' : 'translate-x-full'}">
		<div class="p-6">
			<div class="flex justify-between items-center mb-6">
				<h2 class="font-bold text-gray-800 text-xl">æˆ‘çš„æ—¶é—´çº¿</h2>
				<button 
					class="hover:bg-gray-100 p-2 rounded-lg transition-colors"
					onclick={() => showMobileOutline = false}
					aria-label="å…³é—­å¤§çº²"
				>
					<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
					</svg>
				</button>
			</div>

			<div class="space-y-4 max-h-[calc(100vh-150px)] overflow-y-auto">
				{#each sortedOutlineYears as year}
					{@const events = outlineByYear[year]}
					<div class="space-y-2">
						<div class="bg-blue-50 px-3 py-1 rounded-lg font-semibold text-blue-600 text-sm">
							{year} å¹´
						</div>
						{#each events as event}
							<button
								class="w-full text-left p-3 rounded-lg transition-all duration-200 hover:bg-blue-50 border-l-4 {activeEventId === event.id ? 'bg-blue-100 border-blue-500 text-blue-800' : 'border-transparent hover:border-blue-300'}"
								onclick={() => {
									scrollToEvent(event.id);
									showMobileOutline = false;
								}}
							>
								<div class="flex items-center space-x-3">
									<div class="flex-shrink-0 bg-blue-500 rounded-full w-3 h-3"></div>
									<div class="flex-1 min-w-0">
										<div class="font-medium text-gray-800 text-sm truncate">
											{event.title}
										</div>
									</div>
								</div>
							</button>
						{/each}
					</div>
				{/each}
			</div>
		</div>
	</div>

	<!-- æ¡Œé¢ç«¯å·¦ä¾§å›ºå®šå¤§çº² -->
	<div class="fixed left-0 top-0 h-full w-80 bg-white/80 backdrop-blur-sm shadow-lg border-r border-gray-200/50 z-40 transform transition-transform duration-300 {showOutline ? 'translate-x-0' : '-translate-x-72'} hidden lg:block">
		<div class="p-6">
			<div class="flex justify-between items-center mb-6">
				<h2 class="font-bold text-gray-800 text-xl">æˆ‘çš„æ—¶é—´çº¿</h2>
				<button 
					class="hover:bg-gray-100 p-2 rounded-lg transition-colors"
					onclick={() => showOutline = !showOutline}
					aria-label="æ”¶èµ·å¤§çº²"
				>
					<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
					</svg>
				</button>
			</div>

			<div class="space-y-4 max-h-[calc(100vh-150px)] overflow-y-auto">
				{#each sortedOutlineYears as year}
					{@const events = outlineByYear[year]}
					<div class="space-y-2">
						<div class="bg-blue-50 px-3 py-1 rounded-lg font-semibold text-blue-600 text-sm">
							{year} å¹´
						</div>
						{#each events as event}
							<button
								class="w-full text-left p-3 rounded-lg transition-all duration-200 hover:bg-blue-50 border-l-4 {activeEventId === event.id ? 'bg-blue-100 border-blue-500 text-blue-800' : 'border-transparent hover:border-blue-300'}"
								onclick={() => scrollToEvent(event.id)}
							>
								<div class="flex items-center space-x-3">
									<div class="flex-shrink-0 bg-blue-500 rounded-full w-3 h-3"></div>
									<div class="flex-1 min-w-0">
										<div class="font-medium text-gray-800 text-sm truncate">
											{event.title}
										</div>
									</div>
								</div>
							</button>
						{/each}
					</div>
				{/each}
			</div>
		</div>
	</div>

	<!-- æ¡Œé¢ç«¯å¤§çº²æ”¶èµ·/å±•å¼€æŒ‰é’® (éšè—æ—¶æ˜¾ç¤º) -->
	{#if !showOutline}
		<button 
			class="hidden lg:block top-1/2 left-2 z-50 fixed bg-white/90 hover:bg-white shadow-lg hover:shadow-xl backdrop-blur-sm p-3 border border-gray-200/50 rounded-r-lg transition-all -translate-y-1/2"
			onclick={() => showOutline = true}
			aria-label="å±•å¼€å¤§çº²"
		>
			<svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
			</svg>
		</button>
	{/if}

	<!-- ä¸»å†…å®¹åŒºåŸŸ -->
	<div class="transition-all duration-300 {showOutline ? 'lg:ml-80' : 'lg:ml-0'}">
		<div class="mx-auto px-4 py-16 max-w-4xl container">
			<!-- é¡µé¢æ ‡é¢˜ -->
			<div class="mb-16 text-center">
				<h1 class="mb-4 font-bold text-gray-800 text-4xl md:text-5xl">
					æˆ‘çš„ç¼–ç¨‹ä¹‹è·¯
				</h1>
				<p class="mx-auto max-w-2xl text-gray-600 text-xl">
					ä»é›¶å¼€å§‹çš„ç¼–ç¨‹å­¦ä¹ æ—…ç¨‹ï¼Œè®°å½•æ¯ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘å’Œæˆé•¿ç»å†
				</p>
			</div>

			<!-- Timeline ç»„ä»¶ -->
			<div class="bg-white/80 shadow-xl backdrop-blur-sm p-8 border border-gray-200/50 rounded-2xl">
				<Timeline 
					events={timelineEvents} 
					theme="light"
					showIcons={false}
					showYears={true}
					compact={false}
				/>
			</div>

			<!-- æŠ€èƒ½æ€»ç»“ -->
			<div class="gap-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 mt-16">
				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ï¿½</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">åç«¯å¼€å‘</h3>
					<p class="text-gray-600">
						Pythonã€Javaã€SpringBoot å…¨æ ˆå¼€å‘ç»éªŒ
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ğŸŒ</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">å‰ç«¯å¼€å‘</h3>
					<p class="text-gray-600">
						Vue.jsã€Flutter ç§»åŠ¨ç«¯å’ŒWebç«¯å¼€å‘
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">âš™ï¸</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">æ’ä»¶å¼€å‘</h3>
					<p class="text-gray-600">
						C# ç±»åº“å¼€å‘ï¼ŒDalamud æ’ä»¶ç”Ÿæ€è´¡çŒ®
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ğŸ›¡ï¸</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">å®‰å…¨è¯„ä¼°</h3>
					<p class="text-gray-600">
						æ¼æ´æ’æŸ¥å¤„ç†ï¼ŒDevSecOps ç†å¿µå®è·µ
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ğŸ“±</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">ç§»åŠ¨å¼€å‘</h3>
					<p class="text-gray-600">
						Kotlin Android å¼€å‘ï¼Œè·¨å¹³å°åº”ç”¨æ„å»º
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ï¿½</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">æ¸¸æˆå·¥å…·</h3>
					<p class="text-gray-600">
						æ¸¸æˆè¾…åŠ©å·¥å…·å¼€å‘ï¼Œå¼€æºé¡¹ç›®è´¡çŒ®
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ğŸ¢</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">å®ä¹ ç»éªŒ</h3>
					<p class="text-gray-600">
						é“¶è¡Œå®‰å…¨è¯„ä¼°ï¼Œè½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆå®ä¹ 
					</p>
				</div>

				<div class="bg-white/80 shadow-lg backdrop-blur-sm p-6 border border-gray-200/50 rounded-xl">
					<div class="mb-3 text-2xl">ğŸ“š</div>
					<h3 class="mb-3 font-semibold text-gray-800 text-xl">æŒç»­å­¦ä¹ </h3>
					<p class="text-gray-600">
						ä» C++ åˆ°å…¨æ ˆï¼ŒæŒç»­æ¢ç´¢æ–°æŠ€æœ¯æ ˆ
					</p>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	/* ç¡®ä¿å¤§çº²æ»šåŠ¨æ¡æ ·å¼ */
	.space-y-4::-webkit-scrollbar {
		width: 4px;
	}
	
	.space-y-4::-webkit-scrollbar-track {
		background: rgba(0, 0, 0, 0.05);
		border-radius: 2px;
	}
	
	.space-y-4::-webkit-scrollbar-thumb {
		background: rgba(59, 130, 246, 0.3);
		border-radius: 2px;
	}
	
	.space-y-4::-webkit-scrollbar-thumb:hover {
		background: rgba(59, 130, 246, 0.5);
	}

	/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
	@media (max-width: 1024px) {
		.fixed.left-0 {
			display: none !important;
		}
	}
</style>
